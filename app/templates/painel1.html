<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <link href="assets/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/datatables/select.bootstrap4.min.css" rel="stylesheet" type="text/css" />

    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link href="css/util.css" rel="stylesheet" type="text/css" />

    <link href="assets/plugins/jstree/style.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/switchery/switchery.min.css" rel="stylesheet" />

    <link href="assets/plugins/fileuploads/css/dropify.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/sweet-alert/sweetalert2.min.css" rel="stylesheet" type="text/css" />

    <!-- <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.9.2.css"> -->

    <script src="assets/js/modernizr.min.js"></script>

</head>

<body>
    <div class="container-fluid no-gutters w-100">
        <div class="row" style="height: 60px; border-bottom: 1px dotted darkgray; background-color: #1C2139;" id="divTop">
            <div class=col-sm-12>
                <div class="row">
                    <div class="col-sm-2">
                        <div class="logo">
                            <img src="images/logoDataMigra.png" alt="Data Dev" style="height: 50px;" />
                            &nbsp;&nbsp;<label style="font-size: 13pt; color: white;">Data Dev - Painel</label>
                        </div>                
                    </div>
                    <div class="col-sm-8"></div>
                    <div class="col-sm-2">
                        <div class="btn-group pull-right m-t-20">
                            <button type="button" class="btn btn-custom btn-rounded dropdown-toggle waves-effect waves-light" data-toggle="dropdown" aria-expanded="false">
                                Configurações </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a href="#" onclick="undefUser(1);login();" class="dropdown-item">Usuários</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="border-bottom: 1px dotted darkgray;">
            <div class=col-sm-12>
                <div class="row" id="divMain">
                    <div class="col-sm-2">
                        <div class="row" id="divTabelas">
                            <div class="col-sm-12" style="border-right: 1px dotted darkgray;">
                                <br>
                                <label>Selecione a base</label>
                                <hr />
        
                                <input type="checkbox" id="RB_CTPS"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_CTPS">CTPS</label><br><br>
        
                                <input type="checkbox" id="RB_CGIL" data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_CGIL">CGIL</label><br><br>
        
                                <input type="checkbox" id="RB_CAGED"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_CAGED">CAGED</label><br><br>
        
                                <input type="checkbox" id="RB_RAIS"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_RAIS">RAIS</label><br><br>
        
                                <input type="checkbox" id="RB_SISMIGRA_ENTRADA"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_SISMIGRA_ENTRADA">SisMigra Entrada</label><br><br>
        
                                <input type="checkbox" id="RB_SISMIGRA_REGISTRO"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_SISMIGRA_REGISTRO">SisMigra Registro</label><br><br>
        
                                <input type="checkbox" id="RB_STI"  data-plugin="switchery" data-color="orange" data-size="small" onchange="habilitaTabela(this.id);">
                                <label for="RB_STI">STI</label>
        
                                <br>
                                <hr />
                                <br>
                                <label>Área de upload</label>
                                <form id="form1" action="#" data-parsley-validate novalidate>
                                    <input class="dropify" type="file" accept=".zip,.rar" multiple id="csvFile" name="csvFile" data-height="150" /><br>
                                    <button id="BTN_UPLOAD" class="btn btn-purple btn-rounded waves-effect waves-light" onclick="undefUser(); login();"
                                        style="width: 100%;">
                                        Confirmar upload &nbsp;&nbsp;<i class="mdi mdi-cloud-upload"></i>
                                    </button>
                                    <br><br>
                                    <label id="LBL_UPLOAD"></label>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <div class="row" id="divChart" style="height: 500px;">
                            <div class="col-sm-12">
                                <div class="row">
                                    <div class="col-xl-12">
                                        <div class="form-inline" id="divColTables" style="border-bottom: 1px dotted darkgray;"></div>
                                    </div>
                                </div>
                                <div id="divChart1" class="row" style="border-top: 1px dotted darkgray; height: 300px;">
                                    <label>Chart</label>
                                </div>
                                <div id="divGrid" class="row" style="border-top: 1px dotted darkgray; height: 200px;">
                                    <label style="color: transparent;">X</label>
                                    <table id="tbGrid" class="table table-bordered" cellspacing="0" style="width: 100%;
                                        background-color: white;">
                                        <thead>
                                            <tr>
                                                <th style="width: 10%;">Ano</th>
                                                <th style="width: 15%;">Mês</th>
                                                <th style="width: 20%;">Município</th>
                                                <th style="width: 15%;">UF</th>
                                                <th style="width: 20%;">País</th>
                                                <th style="width: 10%;">Continente</th>
                                                <th style="width: 10%;">Sexo</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="row">
                            <div class="col-sm-12" style="border-left: 1px dotted darkgray;" id="divFiltros">
                                <br>
                                <div id="accordion">
                                    <div class="card">
                                        <div class="card-header" id="headingOne">
                                            <h6 class="m-0">
                                                <a href="#colAno" class="text-dark" data-toggle="collapse" aria-expanded="true" aria-controls="colAno">
                                                    <label style="cursor: pointer;" id="lbl_Ano">Ano e mês</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colAno" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                                            <div class="card-body" id="treeAno" style="overflow: auto; height: 290px;">
        
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingTwo">
                                            <h6 class="m-0">
                                                <a href="#colTipoAutorizacao" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colTipoAutorizacao">
                                                    <label style="cursor: pointer;" id="lbl_TipoAutorizacao">Tipo de autorização</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colTipoAutorizacao" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                                            <div class="card-body" style="overflow: auto; height: 290px;" id="treeTipoAutorizacao">
                                                
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingThree">
                                            <h6 class="m-0">
                                                <a href="#colContinente" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colContinente">
                                                    <label style="cursor: pointer;" id="lbl_Continente">Continente</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colContinente" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                                            <div id="treeContinente" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingFour">
                                            <h6 class="m-0">
                                                <a href="#colPais" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colPais">
                                                    <label style="cursor: pointer;" id="lbl_Pais">País</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colPais" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
                                            <div id="treePais" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingFive">
                                            <h6 class="m-0">
                                                <a href="#colUF" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colUF">
                                                    <label style="cursor: pointer;" id="lbl_UF">UF</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colUF" class="collapse" aria-labelledby="headingFive" data-parent="#accordion">
                                            <div id="treeUF" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingEleven">
                                            <h6 class="m-0">
                                                <a href="#colMunicipio" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colMunicipio">
                                                    <label style="cursor: pointer;" id="lbl_Municipio">Município</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colMunicipio" class="collapse" aria-labelledby="headingEleven" data-parent="#accordion">
                                            <div id="treeMunicipio" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
        
                                        <div class="card-header" id="headingSix">
                                            <h6 class="m-0">
                                                <a href="#colSexo" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colSexo">
                                                    <label style="cursor: pointer;" id="lbl_Sexo">Sexo</label>
                                                </a>
                                            </h6>
                                        </div>
                            
                                        <div id="colSexo" class="collapse" aria-labelledby="headingSix" data-parent="#accordion">
                                            <div id="treeSexo" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
                                        
                                        <div class="card-header" id="headingSeven">
                                            <h6 class="m-0">
                                                <a href="#colTipologia_Extrator" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colTipologia_Extrator">
                                                    <label style="cursor: pointer;" id="lbl_Tipologia_Extrator">Classificação</label>
                                                </a>
                                            </h6>
                                        </div>
                            
                                        <div id="colTipologia_Extrator" class="collapse" aria-labelledby="headingSeven" data-parent="#accordion">
                                            <div id="treeTipologia_Extrator" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingEight">
                                            <h6 class="m-0">
                                                <a href="#colTipo_Visto" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colTipo_Visto">
                                                        <label style="cursor: pointer;" id="lbl_TipoVisto">Tipo de visto</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colTipo_Visto" class="collapse" aria-labelledby="headingEight" data-parent="#accordion">
                                            <div id="treeTipo_Visto" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingNine">
                                            <h6 class="m-0">
                                                <a href="#colAdmitidosDesligados" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colAdmitidosDesligados">
                                                        <label style="cursor: pointer;" id="lbl_AdmitidosDesligados">Tipo de movimentação</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colAdmitidosDesligados" class="collapse" aria-labelledby="headingNine" data-parent="#accordion">
                                            <div id="treeAdmitidosDesligados" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                        <div class="card-header" id="headingTen">
                                            <h6 class="m-0">
                                                <a href="#colTipo_Movimento" class="text-dark" data-toggle="collapse" aria-expanded="false" aria-controls="colTipo_Movimento">
                                                        <label style="cursor: pointer;" id="lbl_TipoMovimento">Tipo de movimento</label>
                                                </a>
                                            </h6>
                                        </div>
        
                                        <div id="colTipo_Movimento" class="collapse" aria-labelledby="headingTen" data-parent="#accordion">
                                            <div id="treeTipo_Movimento" class="card-body" style="overflow: auto; height: 290px;">
                                            </div>
                                        </div>
        
                                    </div>
                                </div>
                                <br>
                                <hr>
                                <button class="btn btn-rounded btn-success waves-light waves-effect" style="width: 100%;" onclick="downloadData();">
                                    Download &nbsp;&nbsp;<i class="mdi mdi-cloud-download"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div id="divLogin" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog"
                aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none; top: 150pt;">
            <div class="modal-dialog modal-sm">
                <div class="modal-content" style="background-color: #EBEFF2;">
                    <div class="modal-header">
                        <h4 class="modal-title mt-0" id="myLargeModalLabel">Login e senha</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>e-mail*</label>
                            <input type="email" parsley-trigger="change" required maxlength="80"
                                    placeholder="e-mail" class="form-control" id="TXT_EMAIL">
                        </div>
                        <div class="form-group">
                            <label>Senha*</label>
                            <input parsley-trigger="change" type="password" maxlength="20"
                                    placeholder="Senha" class="form-control" id="TXT_SENHA" />
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary btn-rounded waves-effect waves-light" style="width: 100%;" onclick="validaLogin();">
                                Ok
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/waves.js"></script>
<script src="assets/js/jquery.slimscroll.js"></script>

<script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>

<script src="assets/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="assets/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="assets/plugins/datatables/jszip.min.js"></script>
<script src="assets/plugins/datatables/pdfmake.min.js"></script>
<script src="assets/plugins/datatables/vfs_fonts.js"></script>
<script src="assets/plugins/datatables/buttons.html5.min.js"></script>
<script src="assets/plugins/datatables/buttons.print.min.js"></script>
<script src="assets/plugins/switchery/switchery.min.js"></script>

<script src="assets/plugins/datatables/dataTables.keyTable.min.js"></script>

<script src="assets/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="assets/plugins/datatables/responsive.bootstrap4.min.js"></script>

<script src="assets/plugins/datatables/dataTables.select.min.js"></script>

<script src="assets/js/jquery.core.js"></script>
<script src="assets/js/jquery.app.js"></script>

<script src="assets/plugins/fileuploads/js/dropify.min.js"></script>

<script src="assets/plugins/sweet-alert/sweetalert2.min.js"></script>
<script src="assets/pages/jquery.sweet-alert.init.js"></script>

<script src="scripts/util.js"></script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"> </script>

<!-- <script src="https://code.jquery.com/qunit/qunit-2.9.2.js"></script> -->

<script type="text/javascript">

    const keep = '8Kd4KmTesIXTOI8awHuhod1X7ERl3divuinW5b8CSNhcO2kITIwUkJDzZpHgZyXx';
    const _id = 1;

    const drawChart = (data1) => {

        const data = google.visualization.arrayToDataTable(data1);

        const options = {
            fontName: 'Calibri',
            //colors: 'darkorange',
            dataOpacity: 1.0,
            title: 'Contadores por classificação',
            height: $('#divChart1').height(),
            width: '100%',
            bars: 'horizontal',

            vAxis: {title: 'Indicadores', gridlines: { color: 'black' }, gridlines: { count: 10 } },
            hAxis: {title: 'Ano', gridlines: { color: 'darkgray' }},
            seriesType: 'bars',

            backgroundColor: { fill: 'transparent' },
            
            bar: { groupWidth: '60%' },
            legend: { position: 'bottom' },
            series: {
                0: { color: '#71B6F9' },
                1: { color: '#FFA401' },
                2: { color: 'green' },
                3: { color: 'purple' },
                4: { color: 'darkgray' },
                5: { color: '#43459d' },
            },
            titleTextStyle: {
                fontSize: 16,
                bold: true,
                italic: false,
            }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('divChart1'));
        chart.draw(data, options);
    };

    google.charts.load('current', { 'packages': ['corechart'] });

    const h = window.innerHeight;

    let _filterMethods;

    let _loged = 0;
    let anos = [];
    let sortedMeses = 
        [[0, 'JANEIRO'],
        [1, 'FEVEREIRO'],
        [2, 'MARÇO'],
        [3, 'ABRIL'],
        [4, 'MAIO'],
        [5, 'JUNHO'],
        [6, 'JULHO'],
        [7, 'AGOSTO'],
        [8, 'SETEMBRO'],
        [9, 'OUTUBRO'],
        [10, 'NOVEMBRO'],
        [11, 'DEZEMBRO']];

    const tabelas =  ['RB_CTPS', 'RB_CGIL', 'RB_CAGED', 'RB_RAIS', 'RB_SISMIGRA_ENTRADA', 'RB_SISMIGRA_REGISTRO', 'RB_STI'];

    const cbFilters = ['CB_FILTRO_ANO', 
        'CB_FILTRO_MES', 
        'CB_FILTRO_MUNICIPIO', 
        'CB_FILTRO_UF', 
        'CB_FILTRO_PAIS', 
        'CB_FILTRO_CONTINENTE',
        'CB_FILTRO_SEXO'];

    const filterGroups = [{ 'id': 'RB_CTPS', 'table': 'mapCTPS',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingSeven', 'colTipologia_Extrator',
            'headingEight', 'colTipo_Visto',
            'headingNine', 'colAdmitidosDesligados',
            'headingTen', 'colTipo_Movimento'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingEleven', 'colMunicipio']
        }, { 'id': 'RB_CGIL', 'table': 'mapCGIL',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingSeven', 'colTipologia_Extrator',
            'headingNine', 'colAdmitidosDesligados',
            'headingTen', 'colTipo_Movimento',
            'headingEleven', 'colMunicipio'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingEight', 'colTipo_Visto']
        }, { 'id': 'RB_CAGED', 'table': 'mapCAGED',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingSeven', 'colTipologia_Extrator',
            'headingEight', 'colTipo_Visto',
            'headingTen', 'colTipo_Movimento'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingNine', 'colAdmitidosDesligados',
            'headingEleven', 'colMunicipio']
        }, { 'id': 'RB_RAIS', 'table': 'mapRAIS',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingSeven', 'colTipologia_Extrator',
            'headingEight', 'colTipo_Visto',
            'headingNine', 'colAdmitidosDesligados',
            'headingTen', 'colTipo_Movimento'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingEleven', 'colMunicipio']
        }, { 'id': 'RB_SISMIGRA_ENTRADA', 'table': 'mapSISMIGRA_ENTRADA',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingEight', 'colTipo_Visto',
            'headingNine', 'colAdmitidosDesligados',
            'headingTen', 'colTipo_Movimento',
            'headingEleven', 'colMunicipio'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingSeven', 'colTipologia_Extrator']
        }, { 'id': 'RB_SISMIGRA_REGISTRO', 'table': 'mapSISMIGRA_REGISTRO',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingEight', 'colTipo_Visto',
            'headingNine', 'colAdmitidosDesligados',
            'headingTen', 'colTipo_Movimento',
            'headingEleven', 'colMunicipio'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingSeven', 'colTipologia_Extrator']
        }, { 'id': 'RB_STI', 'table': 'mapSTI',
        'toHide': 
            ['headingTwo', 'colTipoAutorizacao',
            'headingEight', 'colTipo_Visto',
            'headingNine', 'colAdmitidosDesligados',
            'headingEleven', 'colMunicipio'],
        'toShow': 
            ['headingOne', 'colAno',
            'headingThree', 'colContinente',
            'headingFour', 'colPais',
            'headingFive', 'colUF',
            'headingSix', 'colSexo',
            'headingTen', 'colTipo_Movimento',
            'headingSeven', 'colTipologia_Extrator']
        }];

    const undefUser = (xUser) => {
        _user = xUser;
    };

    const carregaFiltroAnosMeses = (item) => {
        const url = '/carregaFiltroAnosMeses';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            if (data1.length > 0) {
                if (typeof(data1[0]) == 'object') {
                    configuraAnoMes(data1);
                }
                else if (typeof(data1[0]) == 'string') {
                    const ctrl = $('#treeAno');

                    ctrl.empty();

                    let str1 = '<ul>';

                    data1.map((item) => {
                        const _item = item.replaceAll(' ', '_');

                        const ctrl = '<div class="checkbox">' +
                                        '<input type="checkbox" id="Ano_' + _item + '" />' +
                                        '<label id="lbl_Ano_' + _item + '" for="Ano_' + _item + '" style="cursor: pointer;">' + item + '</label>' +
                                        '</div>';

                        str1 += '<li id="li_' + _item + '">' + ctrl + '</li>';
                    });

                    str1 += '</ul>';
                    
                    ctrl.append(str1).change();

                    const curTitle = 'Ano';
                    const _title = filterTitle(item, 'lbl_Ano', curTitle);
                    $('#lbl_Ano').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');
                }

                continuaFiltro(item);
            }
        };

        doranAjax(url, data, success);
    };

    const configuraAnoMes = (data) => {
        anos = data.map((item) => {
            return item[0];
        }).filter(distinct);

        $('#treeAno').empty();

        let str1 = '<ul>';

        anos.map((item) => {
            const meses = sortedMeses.filter((item2) => {
                mes = item2[1];

                const filtered = data.filter((item1) => {
                    return item1[0] == item && mes == item1[1].replaceAll('"', '');
                });

                return filtered.length > 0 ?
                    filtered[0][0] == item && filtered[0][1].replaceAll('"', '') == mes : false;
            });

            let str2 = '<ul>';

            meses.map((item1) => {
                const idControl = 'Mes_' + item1[1] + 'Ano_' + item;

                const control = '<div class="checkbox">' +
                                '&nbsp;&nbsp;' +
                                "<input type='checkbox' id='" + idControl + "' onchange='selecionaParente(this.id, \"Ano\");' />" +
                                '<label id="lbl_' + idControl + '" for="' + idControl + '" style="cursor: pointer;">' + item1[1] + '</label>' +
                                '</div>';

                str2 += '<li id="li1_' + item + '">' + control + '</li>';
            });

            str2 += '</ul>';

            const ctrl = '<div class="checkbox">' +
                            '&nbsp;&nbsp;' +
                            '<input type="checkbox" id="Ano_' + item + '" />' +
                            '<label id="lbl_Ano_' + item + '" for="Ano_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                            '</div>';

            str1 += '<li id="li_' + item + '" style="cursor: pointer;" onclick="toggleLi(this.id);">' + ctrl + ' ' + str2 + '</li>';
        });

        str1 += '</ul>';

        $('#treeAno').append(str1).change();

        const table = tabelas.filter((item) => {
            return $('#' + item).is(':checked')
        });

        const curTitle = 'Ano e mês';
        const _title = filterTitle(table[0].replaceAll('RB_', ''), 'lbl_Ano', curTitle);
        $('#lbl_Ano').html(_title + ' (<b>' + anos.length + ' registro(s)</b>)');
    };

    const carregaFiltroPais = (item) => {
        const url = '/carregaFiltroPais';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treePais');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const _item = item.replaceAll(' ', '_');

                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="Pais_' + _item + '" />' +
                                '<label id="lbl_Pais_' + _item + '" for="Pais_' + _item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + _item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'País';
            const _title = filterTitle(item, 'lbl_Pais', curTitle);
            $('#lbl_Pais').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroContinente = (item) => {
        const url = '/carregaFiltroContinente';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeContinente');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const _item = item.replaceAll(' ', '_');

                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="Continente_' + _item + '" />' +
                                '<label id="lbl_Continente_' + _item + '" for="Continente_' + _item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + _item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Continente';
            const _title = filterTitle(item, 'lbl_Continente', curTitle);
            $('#lbl_Continente').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroSexo = (item) => {
        const url = '/carregaFiltroSexo';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeSexo');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="Sexo_' + item + '" />' +
                                '<label id="lbl_Sexo_' + item + '" for="Sexo_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Sexo';
            const _title = filterTitle(item, 'lbl_Sexo', curTitle);
            $('#lbl_Sexo').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroUF = (item) => {
        const url = '/carregaFiltroUF';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeUF');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item1) => {
                const _item1 = item1.replaceAll(' ', '_');

                const params = "'" + item + "', '" + item1 + "', 'UF_" + _item1 + "'";

                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="UF_' + _item1 + '" onclick="carregaFiltroMunicipio(' + params + ');" />' +
                                '<label id="lbl_UF_' + _item1 + '" for="UF_' + _item1 + '" style="cursor: pointer;">' + item1 + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + _item1 + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'UF';
            const _title = filterTitle(item, 'lbl_UF', curTitle);
            $('#lbl_UF').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroMunicipio = (item, UF, Id) => {

        if (!$('#' + Id).is(':checked'))
            return;

        const url = '/carregaFiltroMunicipio';
        const data = {
            keep: keep,
            item: item,
            UF: UF
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeMunicipio');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const _item = item.replaceAll(' ', '_');

                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="Municipio_' + UF + _item + '" />' +
                                '<label id="lbl_Municipio_' + UF + _item + '" for="Municipio_' + UF + _item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + UF + _item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Município';
            const _title = filterTitle(item, 'lbl_Municipio', curTitle);
            $('#lbl_Municipio').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroTipologia_Extrator = (item) => {

        const url = '/carregaFiltroTipologia_Extrator';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeTipologia_Extrator');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="Tipologia_Extrator_' + item + '" />' +
                                '<label id="lbl_Tipologia_Extrator_' + item + '" for="Tipologia_Extrator_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Classificação';
            const _title = filterTitle(item, 'lbl_Tipologia_Extrator', curTitle);
            $('#lbl_Tipologia_Extrator').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    
    
    };

    const carregaFiltroTipoVisto = (item) => {
        const url = '/carregaFiltroTipoVisto';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeTipo_Visto');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="TipoVisto_' + item + '" />' +
                                '<label id="lbl_TipoVisto_' + item + '" for="TipoVisto_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Tipo / Visto';
            const _title = filterTitle(item, 'lbl_TipoVisto', curTitle);
            $('#lbl_TipoVisto').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroAdmitidosDesligados = (item) => {
        const url = '/carregaFiltroAdmitidosDesligados';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeAdmitidosDesligados');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="AdmitidosDesligados_' + item + '" />' +
                                '<label id="lbl_AdmitidosDesligados_' + item + '" for="AdmitidosDesligados_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Tipo de movimentação';
            const _title = filterTitle(item, 'lbl_AdmitidosDesligados', curTitle);
            $('#lbl_AdmitidosDesligados').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const carregaFiltroTipoMovimento = (item) => {
        const url = '/carregaFiltroTipoMovimento';
        const data = {
            keep: keep,
            item: item
        };

        const success = function (response) {
            const data1 = eval(response);

            const ctrl = $('#treeTipo_Movimento');

            ctrl.empty();

            let str1 = '<ul>';

            data1.map((item) => {
                const ctrl = '<div class="checkbox">' +
                                '<input type="checkbox" id="TipoMovimento_' + item + '" />' +
                                '<label id="lbl_TipoMovimento_' + item + '" for="TipoMovimento_' + item + '" style="cursor: pointer;">' + item + '</label>' +
                                '</div>';

                str1 += '<li id="li_' + item + '">' + ctrl + '</li>';
            });

            str1 += '</ul>';

            ctrl.append(str1).change();

            const curTitle = 'Tipo de movimento';
            const _title = filterTitle(item, 'lbl_TipoMovimento', curTitle);
            $('#lbl_TipoMovimento').html(_title + ' (<b>' + data1.length + ' registro(s)</b>)');

            continuaFiltro(item);
        };

        doranAjax(url, data, success);
    };

    const continuaFiltro = (item) => {
        _methodCount++;

        if (_methodCount < _filterMethods.length)
            _filterMethods[_methodCount](item);
    }

    const selecionaParente = (ctrl, starts) => {

        const parent = ctrl.substring(ctrl.indexOf(starts));

        if ($('#' + ctrl).is(':checked'))
            $('#' + parent).prop('checked', true);
    };

    const selecionaItens = (ctrl) => {
        let li = ctrl.replaceAll('Ano', 'li');
        li = li.replaceAll('UF', 'li');

        const checks = $('#' + li).children().children().children().children();

        for (let i  = 0; i < checks.length; i++) {
            if ((i % 2) == 0) { 
                const Id = '#' + checks[i].id;
                $(Id).prop('checked', $('#' + ctrl).is(':checked'));
            }
        }
    };

    const toggleLi = (ctrl) => {
        $('#' + ctrl).find('ul').toggle();
    };

    const bindEvent = (tabelas, _bind, _event, _id) => {
        if (!_bind) {
            tabelas.map((item) => {
                $('#' + item).unbind(_event);
            });
        }

        if (_bind) {
            tabelas.map((item) => {
                $('#' + item).bind(_event, () => {
                    habilitaTabela(_id);
                });
            });
        }
    };

    const habilitaTabela = (id) => {

        if (!$('#' + id).is(':checked'))
            return;

        const table = filterGroups.filter((item) => {
                return item.id == id;
            })[0].table;

        getTables(table);

        $('#divChart1').empty();
        atualizaGrid([], []);

        const selectedCtrl = $('#' + id);

        bindEvent(tabelas, false, 'change');

        tabelas.map((item) => {
            const ctrl = $('#' + item);

            if (item != id && selectedCtrl.is(':checked') && ctrl.is(':checked'))
                ctrl.click();
        });

        bindEvent(tabelas, true, 'change', id);

        const isChecked = selectedCtrl.is(':checked');

        reloadFilters(isChecked ? id : '');

        showHideFilters(id);
    };

    const resetLabels = () => {
        $('#lbl_Ano').html('Ano e mês');
        $('#lbl_Continente').html('Continente');
        $('#lbl_Pais').html('País');
        $('#lbl_UF').html('UF');
        $('#lbl_Municipio').html('Municipio');
        $('#lbl_Sexo').html('Sexo');
        $('#lbl_TipologiaExtrator').html('Classificação');
        $('#lbl_TipoVisto').html('Tipo de visto');
        $('#lbl_TipoMovimento').html('Tipo de Movimento');
        $('#lbl_TipoAutorizacao').html('Tipo de Autorização');
        $('#lbl_AdmitidosDesligados').html('Tipo de movimentação');

        $('#treeAno').empty();
        $('#treeTipoAutorizacao').empty();
        $('#treeContinente').empty();
        $('#treePais').empty();
        $('#treeSexo').empty();
        $('#treeUF').empty();
        $('#treeMunicipio').empty();
        $('#treeTipologia_Extrator').empty();
        $('#treeTipo_Movimento').empty();
        $('#treeAdmitidosDesligados').empty();
        $('#treeTipo_Visto').empty();
    };

    let _methodCount = 0;
    let _methods;

    const reloadFilters = (id) => {

        resetLabels();

        if (id.length > 0) {

            const items = [
                {idx: 0, item: 'CTPS' },
                {idx: 1, item: 'CGIL' },
                {idx: 2, item: 'CAGED' },
                {idx: 3, item: 'RAIS' },
                {idx: 4, item: 'SISMIGRA_ENTRADA' },
                {idx: 5, item: 'SISMIGRA_REGISTRO'},
                {idx: 6, item: 'STI'}
                ];

            _methods = [
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF], // CTPS
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF, carregaFiltroTipoVisto], // CGIL
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF, carregaFiltroAdmitidosDesligados], // CAGED
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF], // RAIS
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF, carregaFiltroTipologia_Extrator], // SISMIGRA ENTRADA
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF, carregaFiltroTipologia_Extrator], // SISMIGRA REGISTRO
                [carregaFiltroAnosMeses, carregaFiltroPais, carregaFiltroContinente, carregaFiltroSexo, carregaFiltroUF, carregaFiltroTipologia_Extrator, carregaFiltroTipoMovimento] // STI
                ];
            
            _methodCount = 0;

            const row = items.filter(e => e.item == id.replaceAll('RB_', ''));

            _filterMethods = _methods[row[0].idx];
            _methods[row[0].idx][0](row[0].item);
        }
    };
    
    let _user;

    const login = () => {
        event.preventDefault();

        if (_loged == 0) {
            $('#divLogin').modal();

            setTimeout(() => {
                $('#TXT_EMAIL').focus();
            }, 500);
        }
        else if (_loged == 1 && !_user)
            uploadFiles();
        else if (_loged == 1 && _user)
            abre('/toUsuario');
    };

    const validaLogin = () => {
        const usuario = $('#TXT_EMAIL').val();
        const senha = $('#TXT_SENHA').val();

        if (usuario.length == 0 || senha.length == 0) {
            MensagemDeErro('Dados inválidos');
            return;
        }

        const url = '/validaLogin';
        const data = {
            EMAIL: usuario,
            SENHA: senha
        };

        const success = function (response) {
            const result = JSON.parse(response);

            _loged = 1;

            $('#divLogin').modal('hide');

            if (!_user)
                uploadFiles();
            
            if (_user)
                abre('/toUsuario')
        };

        const error = function (xhr, status, error) {
            showProcess(false);
            MensagemDeErro(JSON.parse(xhr.responseText).message);
            $('#TXT_SENHA').val('');
        };

        doranAjax(url, data, success, error);
    };

    const uploadFiles = () => {

        const data = new FormData();

        const files = $("#csvFile").get(0).files;

        if (files.length == 0) {
            MensagemDeErro('Selecione 1 ou mais arquivos para fazer o upload');
            return;
        }

        if (files.length > 0) {
            EnableDisableElement('BTN_UPLOAD', false);

            for (let i = 0; i < files.length; i++) {
                $('#LBL_UPLOAD').html('Gravando o arquivo ' + files[i].name + '...').change();

                data.append("UploadedFile", files[i]);

                showProcess(true);

                $.ajax({
                    url: '/doUpload',
                    data: data,
                    type: 'POST',
                    success: function (response) {
                        const result = JSON.parse(response);
                        const rows = result.rowsInserted;

                        EnableDisableElement('BTN_UPLOAD', true);
                        $('#LBL_UPLOAD').empty();

                        showProcess(false);

                        if (i == files.length -1) {
                            $('.dropify-clear').click();
                            MensagemDeSucesso(rows + ' registro(s) foram importado(s) com sucesso');
                        }
                    },
                    error: function (request, status, error) {
                        EnableDisableElement('BTN_UPLOAD', true);

                        MensagemDeErro(JSON.parse(request.responseText).message);

                        $('#LBL_UPLOAD').empty();
                        showProcess(false);
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
        }
    };

    const zipFile = (file) => {
        const zip = new JSZip();

        zip.generateAsync({type:"blob", compression:"default"}).then((content) => {

            const files = new File([content], "name.zip");

                var formData = new FormData();
                formData.append('fileZip', files);

                $.ajax({
                data: formData,
                url : '/your_path',
                type : 'POST',
                processData: false,
                contentType: false,
                success : function(response) {
                    alert("success");
                }
            });

            return;
        });

        let arrayBuffer;
        const fileReader = new FileReader();
        
        fileReader.onload = () => {
            arrayBuffer = this.result;
            zip.file(file.name, arrayBuffer);
            addFileToZip(n + 1);
        };

        fileReader.readAsArrayBuffer(file);
    };

    $('.dropify').dropify({
        messages: {
            'default': 'Arraste e solte os arquivos aqui ',
            'replace': 'Arraste e solte ou clique para trocar os arquivos',
            'remove': 'Remover',
            'error': 'Erro'
        },
        error: {
            'fileSize': 'O tamanho do arquivo está maior que 900Mb.'
        }
    });

    let grid1;

    const atualizaGrid = (data, columns) => {
        const names = getColumnsGrid();

        if (names[0].length == 0 || names[1].length == 0)
            return;

        if (columns.length > 0) {
            $('#divGrid').empty();
            $('#divGrid').append('<label style="color: transparent;">X</label>');

            let htmlMarkup = '<table id="tbGrid" class="table table-bordered" cellspacing="0" style="width: 100%;' +
                'background-color: white;">' +
                '<thead><tr>';

            columns.map((item) => {
                htmlMarkup += '<th>' + item + '</th>';
            });

            htmlMarkup += '</tr></thead></table>';

            $("#divGrid").append(htmlMarkup);
        }

        const _height = parseInt(h * .28);

        if (grid1) {
            $('#tbGrid').DataTable().clear().destroy();
            grid1 = undefined;
        }

        grid1 = $('#tbGrid').DataTable({
            data: data,
            scrollY: _height,
            searching: true,
            pageLength: 25,
            select: {
                style: 'single'
            },
            language: ptBr
        });

        grid1.on('select', function (e, dt, type, indexes) {
            if (type === 'row') {
                
            }
        });
    };

    const perparaFiltro = () => {
        CONTINENTE = [];
        PAIS = [];
        UF = [];
        MUNICIPIO = [];
        ANO = [];
        MES = [];
        SEXO = [];
        TIPO_VISTO = [];
        TIPOLOGIA_EXTRATOR = [];
        TIPO_MOVIMENTO = [];
        ADMITIDOS_DESLIGADOS = [];

        $("input[type='checkbox']").each(function(){
            const Id = $(this).attr('id');
            const isChecked = $(this).is(":checked");

            if (isChecked) {
                const val = $('#lbl_' + Id).text();

                if (Id.startsWith('UF_')) {
                    UF.push(val);
                }
                else if (Id.startsWith('Continente_')) {
                    CONTINENTE.push(val);
                }
                else if (Id.startsWith('Pais_')) {
                    PAIS.push(val);
                }
                else if (Id.startsWith('Ano_')) {
                    ANO.push(val);
                }
                else if (Id.startsWith('Mes_')) {
                    MES.push(val);
                }
                else if (Id.startsWith('Municipio_')) {
                    MUNICIPIO.push(val);
                }
                else if (Id.startsWith('Sexo_')) {
                    SEXO.push(val);
                }
                else if (Id.startsWith('TipoVisto_')) {
                    TIPO_VISTO.push(val);
                }
                else if (Id.startsWith('Tipologia_Extrator_')) {
                    TIPOLOGIA_EXTRATOR.push(val);
                }
                else if (Id.startsWith('TipoMovimento_')) {
                    TIPO_MOVIMENTO.push(val);
                }
                else if (Id.startsWith('AdmitidosDesligados_')) {
                    ADMITIDOS_DESLIGADOS.push(val);
                }
            }
        });

        const retorno = { 'CONTINENTE': CONTINENTE, 
            'PAIS': PAIS,
            'UF': UF,
            'MUNICIPIO': MUNICIPIO,
            'ANO': ANO,
            'MES': MES,
            'SEXO': SEXO,
            'TIPO_VISTO': TIPO_VISTO,
            'TIPOLOGIA_EXTRATOR': TIPOLOGIA_EXTRATOR,
            'TIPO_MOVIMENTO': TIPO_MOVIMENTO,
            'ADMITIDOS_DESLIGADOS': ADMITIDOS_DESLIGADOS };

        return retorno;
    };

    const getColumnsGrid = () => {
        let eixoX = [];
        let series = [];

        $('#CB_X > option').each(function() {
            eixoX.push($(this).val());
        });

        $('#CB_SERIE > option').each(function() {
            series.push($(this).val());
        });

        return [eixoX, series];
    };

    const viewGrid = (table) => {

        const json1 = perparaFiltro();

        let anyFiltered = 0;

        Object.keys(json1).forEach(function(key) {
            anyFiltered += json1[key].length;
        });

        let eixoX = [];
        let series = [];

        $('#CB_X > option').each(function() {
            eixoX.push($(this).val());
        });

        $('#CB_SERIE > option').each(function() {
            series.push($(this).val());
        });

        const url = '/viewGrid';

        const data = {
            ANO: json1.ANO,
            MES: json1.MES,
            UF: json1.UF,
            MUNICIPIO: json1.MUNICIPIO,
            PAIS: json1.PAIS,
            CONTINENTE: json1.CONTINENTE,
            SEXO: json1.SEXO,
            TIPO_VISTO: json1.TIPO_VISTO,
            TIPOLOGIA_EXTRATOR: json1.TIPOLOGIA_EXTRATOR,
            TIPO_MOVIMENTO: json1.TIPO_MOVIMENTO,
            ADMITIDOS_DESLIGADOS: json1.ADMITIDOS_DESLIGADOS,
            keep: keep,
            table: table,
            eixoX: eixoX[0],
            series: series
        };

        const success = function (response) {
            const _response = eval(response);
            const x = eval(_response[0]);
            const y = eval(x[1]);

            const data = [];

            if (x.length == 0) {
                const serie = $('#CB_SERIE').val();

                MensagemDeErro('Filtro da serie [' + serie + '] precisa de até 5 filtros para efetuar a consulta');
                return;
            }

            y.map((item) => {
                data.push(item);
            });

            const columns = eval(x[0]);

            atualizaGrid(data, columns);

            // chart

            const chart = eval(_response[1]);

            drawChart(chart);
        };

        doranAjax(url, data, success);
    };

    const viewChart = (table) => {
        let eixoX = [];
        let series = [];

        $('#CB_X > option').each(function() {
            eixoX.push($(this).val());
        });

        $('#CB_SERIE > option').each(function() {
            series.push($(this).val());
        });

        const json1 = perparaFiltro();

        const url = '/viewChart';

        const data = {
            ANO: json1.ANO,
            MES: json1.MES,
            UF: json1.UF,
            MUNICIPIO: json1.MUNICIPIO,
            PAIS: json1.PAIS,
            CONTINENTE: json1.CONTINENTE,
            SEXO: json1.SEXO,
            TIPO_VISTO: json1.TIPO_VISTO,
            TIPOLOGIA_EXTRATOR: json1.TIPOLOGIA_EXTRATOR,
            TIPO_MOVIMENTO: json1.TIPO_MOVIMENTO,
            ADMITIDOS_DESLIGADOS: json1.ADMITIDOS_DESLIGADOS,
            keep: keep,
            eixoX: eixoX[0],
            series: series,
            table: table
        };

        const success = function (response) {
            const data = eval(response);

            showProcess(true);

            if (data.length == 0) {
                const serie = $('#CB_SERIE').val();

                MensagemDeErro('Filtro da serie [' + serie + '] precisa de até 5 filtros para efetuar a consulta');
                return;
            }

            drawChart(data);
        };

        doranAjax(url, data, success);
    };

    const viewData = () => {
        let i = 0;

        $('#CB_X > option').each(function() { i++; });
        $('#CB_SERIE > option').each(function() { i++; });
        
        const message = i == 2 ? '' : 'Selecione 1 coluna para o Eixo X e Serie';

        if (message.length > 0) {
            MensagemDeErro(message);
            return;
        }

        const table = tabelas.filter((item) => {
            return $('#' + item).is(':checked')
        });

        viewGrid(table[0]);
    };

    const downloadData = () => {

        let i = 0;

        $('#CB_X > option').each(function() { i++; });
        $('#CB_SERIE > option').each(function() { i++; });
        
        const message = i == 2 ? '' : 'Selecione 1 coluna para o Eixo X e Serie';

        if (message.length > 0) {
            MensagemDeErro(message);
            return;
        }

        const json1 = perparaFiltro();

        let anyFiltered = 0;

        Object.keys(json1).forEach(function(key) {
            anyFiltered += json1[key].length;
        });

        let eixoX = [];
        let series = [];

        $('#CB_X > option').each(function() {
            eixoX.push($(this).val());
        });

        $('#CB_SERIE > option').each(function() {
            series.push($(this).val());
        });

        const table = tabelas.filter((item) => {
            return $('#' + item).is(':checked')
        });

        const url = '/downloadData';

        const data = {
            ANO: json1.ANO,
            MES: json1.MES,
            UF: json1.UF,
            MUNICIPIO: json1.MUNICIPIO,
            PAIS: json1.PAIS,
            CONTINENTE: json1.CONTINENTE,
            SEXO: json1.SEXO,
            TIPO_VISTO: json1.TIPO_VISTO,
            TIPOLOGIA_EXTRATOR: json1.TIPOLOGIA_EXTRATOR,
            TIPO_MOVIMENTO: json1.TIPO_MOVIMENTO,
            ADMITIDOS_DESLIGADOS: json1.ADMITIDOS_DESLIGADOS,
            keep: keep,
            table: table[0],
            eixoX: eixoX[0],
            series: series
        };

        const success = function (response) {
            const data1 = JSON.parse(response);

            window.open('/csv/' + data1.link);
        };

        doranAjax(url, data, success);
    };

    const showHideColumn = (Id, idx) => {
        $('#tbGrid').DataTable().column(idx).visible($('#' + Id).is(':checked'));
    };

    const applyVisible = () => {
        cbFilters.map((item, i) => {
            showHideColumn(item, i);
        });
    };

    const showHideFilters = (Id) => {

        const filtered = filterGroups.filter((item) => {
            return item.id == Id;
        });

        filtered.map((item) => {
            item.toHide.map((item1) => {
                $('#' + item1).css('visibility', 'hidden');
                $('#' + item1.replace('col', 'tree')).css('height', '1px');
            });

            item.toShow.map((item1) => {
                $('#' + item1).css('visibility', 'visible');
                
                $('#' + item1.replace('col', 'tree')).css('height', 
                    item1.startsWith('col') ? '290px' : '45px');
            });
        });
    };

    const adicionaXY = (item, Id) => {

        if ($('#' + Id).is(':checked')) {
            let existsX = false;
            let existsY = false;

            $('#CB_X > option').each(function() {
                existsX = true;
            });

            $('#CB_SERIE > option').each(function() {
                existsY = true;
            });

            if (!existsX) {
                $('#CB_X').empty();
                $('#CB_X').append('<option value="' + item + '">' + item + '</option>');

                desabilitaAnoMes(item);
            }
            else if (existsX && !existsY) {
                $('#CB_SERIE').empty();
                $('#CB_SERIE').append('<option value="' + item + '">' + item + '</option>');

                $('#btn_MES').removeAttr('disabled');
                $('#btn_ANO').removeAttr('disabled');
            }
            else if (existsX && existsY) {
                $('#CB_X').empty();
                $('#CB_SERIE').empty();

                $('#CB_X').append('<option value="' + item + '">' + item + '</option>');
                
                desabilitaAnoMes(item);
            }
        }
        else if (!$('#' + Id).is(':checked')) {
            let cX = false;

            $('#CB_X > option').each(function() {
                    if ($(this).val() == item) {
                    cX = true;
                    }
            });

            if (cX)
                $('#CB_X').empty();

            cX = false;

            $('#CB_SERIE > option').each(function() {
                    if ($(this).val() == item) {
                    cX = true;
                    }
            });

            if (cX)
                $('#CB_SERIE').empty();
        }
    };

    const dictDePara = [
        { 'tabela': 'CGIL', 'de': 'TIPO_VISTO', 'para': 'Tipo Autorização', 'filtro': 'lbl_TipoVisto' },
        { 'tabela': 'CAGED', 'de': 'ADMITIDOS_DESLIGADOS', 'para': 'Tipo Movimentação', 'filtro': 'lbl_AdmitidosDesligados' },
        { 'tabela': 'RAIS', 'de': 'PAIS', 'para': 'Nacionalidade', 'filtro': 'lbl_Pais' },
        { 'tabela': 'SISMIGRA_REGISTRO', 'de': 'TIPOLOGIA_ENTRADA', 'para': 'Classificação', 'filtro': 'lbl_Tipologia_Extrator' },
        { 'tabela': 'SISMIGRA_ENTRADA', 'de': 'TIPOLOGIA_ENTRADA', 'para': 'Classificação', 'filtro': 'lbl_Tipologia_Extrator' },
        { 'tabela': 'STI', 'de': 'TIPO_MOVIMENTO', 'para': 'Tipo Movimentação', 'filtro': 'lbl_TipoMovimento' },
        { 'tabela': 'STI', 'de': 'TIPOLOGIA_ENTRADA', 'para': 'Tipologias', 'filtro': 'lbl_Tipologia_Extrator' }
    ];

    const setButtons = (ctrls) => {
        const dict1 = { 
            'CGIL': 'Dados referentes às concessões de trabalho para que os migrantes possam trabalhar regularmente no Brasil, sob responsabilidade da Coordenação Geral de Imigração do Ministério da Justiça',
            'RAIS': 'Dados da Relação Anual de Informações Sociais referentes ao estoque de trabalhadores migrantes no mercado de trabalho formal em 31/12', 
            'CTPS': 'Dados referentes à emissão da Carteira de Trabalho e Previdência Social para trabalhadores migrantes', 
            'CAGED': 'Dados do Cadastro Geral de Empregados e Desempregados referentes à movimentação dos trabalhadores migrantes no mercado de trabalho formal', 
            'SISMIGRA_ENTRADA': 'Dados do Sistema Nacional de Registro Migratório, sob responsabilidade da Polícia Federal, referentes ao registro de migrantes autorizados a residir regularmente no Brasil', 
            'SISMIGRA_REGISTRO': 'Dados do Sistema Nacional de Registro Migratório, sob responsabilidade da Polícia Federal, referentes ao registro de migrantes autorizados a residir regularmente no Brasil', 
            'STI': 'Dados do Sistema de Tráfego Internacional, sob responsabilidade da Polícia Federal, referentes ao controle de entradas e saídas pelos postos de fronteira.' 
          };

        const dictTips = { 
            'CGIL': { 
                'ANO': 'Ano de concessão da autorização de trabalho',
                'MES': 'Mês de concessão da autorização de trabalho',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'Indica o país de nascimento do imigrante',
                'CONTINENTE': 'Continente do país',
                'TIPO_VISTO': 'Indica se o processo é prévia ou em território (residência)',
                'SEXO': 'Indica o sexo do imigrante'
            },
            'CTPS': { 
                'ANO': 'Ano de concessão da autorização de trabalho',
                'MES': 'Mês de concessão da autorização de trabalho',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nascimento da pessoa',
                'CONTINENTE': 'Continente do país',
                'MUNICIPIO': 'Nome dos municípios',
                'SEXO': 'Indica o sexo do imigrante'
            },
            'RAIS': { 
                'ANO': 'Ano de concessão da autorização de trabalho',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nascimento da pessoa',
                'CONTINENTE': 'Continente do país',
                'MUNICIPIO': 'Nome dos municípios',
                'SEXO': 'Sexo do trabalhador'
            },
            'CAGED': { 
                'ADMITIDOS_DESLIGADOS': 'Indica se a movimentação foi de admissão ou de desligamento',
                'ANO': 'Ano de concessão da autorização de trabalho',
                'MES': 'Mês de competência da movimentação',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nascimento da pessoa',
                'CONTINENTE': 'Continente do país',
                'MUNICIPIO': 'Nome dos municípios',
                'SEXO': 'Sexo da pessoa'
            },
            'SISMIGRA_REGISTRO': { 
                'ANO': 'Ano que o migrante se registrou na Polícia Federal',
                'MES': 'Mês que o migrante se registrou na Polícia Federal',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nascimento da pessoa',
                'CONTINENTE': 'Continente do país',
                'MUNICIPIO': 'Nome dos municípios',
                'SEXO': 'Sexo do requerente de residência',
                'TIPOLOGIA_ENTRADA': 'Status migratório'
            },
            'SISMIGRA_ENTRADA': { 
                'ANO': 'Ano que o migrante entrou no Brasil',
                'MES': 'Mês que o migrante entrou no Brasil',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nascimento do requerente de residência',
                'CONTINENTE': 'Continente do país',
                'MUNICIPIO': 'Nome dos municípios',
                'SEXO': 'Sexo do requerente de residência',
                'TIPOLOGIA_ENTRADA': 'Status migratório'
            },
            'STI': { 
                'ANO': 'Ano da movimentação pelos postos de fronteira',
                'MES': 'Mês da movimentação pelos postos de fronteira',
                'UF': 'Nome da Unidade da Federação',
                'PAIS': 'País de nacionalidade da pessoa',
                'CONTINENTE': 'Continente do país',
                'SEXO': 'Sexo do requerente de residência',
                'TIPOLOGIA_ENTRADA': 'Status migratório',
                'TIPO_MOVIMENTO': 'Leva em consideração se o migrante está entrando ou saindo do Brasil'
            },
        };

        const table = tabelas.filter((item) => {
            return $('#' + item).is(':checked')
        });

        const _table = table[0].replace('RB_', '');

        let checks = '<label>' + _table + ' - ' + dict1[_table] + '</label><br><br>';

        ctrls.map((item) => {
            const _item = "'" + item + "'";

            const fTitle = dictDePara.filter(e => e.tabela == _table && e.de == item);
            const _title = fTitle.length > 0 ? fTitle[0].para.toUpperCase() : item;

            checks += 
                '<div class="form-check form-check-inline">' +
                    '<input type="checkbox" id="btn_' + item + '" data-plugin="switchery" data-size="small" onchange="adicionaXY(' + _item + ', this.id);">' +
                    '&nbsp;&nbsp;<label for="btn_' + item + '" style="cursor: pointer;" title="' + dictTips[_table][item] + '">' + _title + '</label> &nbsp;&nbsp;&nbsp;&nbsp;';
                '</div>';
        });

        checks += 
            '<br><button class="btn btn-purple btn-rounded waves-effect waves-light"' +
                'onclick="viewData();">Visualizar dados&nbsp;&nbsp;<i class="mdi mdi-chart-line"></i>' +
            '</button>&nbsp;<button class="btn btn-inverse btn-rounded waves-effect waves-light"' +
                'onclick="limpaFiltro();">Limpar filtros&nbsp;&nbsp;<i class="mdi mdi-bookmark-remove"></i>' +
            '</button>';

        $('#divColTables').empty().change();
        $('#divColTables').append(checks);

        checks = 
                '<select style="visibility: hidden;" id="CB_X" class="form-control" placeholder="Eixo X" style="width: 10px;">' +
                '</select>' +
                '<select style="visibility: hidden;" id="CB_SERIE" class="form-control" placeholder="Series" style="width: 10px;">' +
                '</select>';

        $('#divColTables').append(checks);
    };

    const limpaFiltro = () => {
        let checks = Array.from(document.querySelectorAll("input[type='checkbox']"));

        checks.forEach((ck) => {
            if (!ck.id.startsWith('RB_')){
                ck.checked = false;
            }

            $('#CB_X').empty();
            $('#CB_SERIE').empty();
        });
    };

    const filterTitle = (_table, _label, _title) => {

        const ft = dictDePara.filter(e => e.tabela == _table && e.filtro == _label);

        ft.map((item) => {
            _title = item.para;
        });

        return _title;
    };

    const getTables = (table) => {
        const url = '/getTables';
        const data = {
            keep: keep
        };

        const success = function (response) {
            const data1 = JSON.parse(response);

            let row = data1.fields.filter((item, i) => { 
                return data1.fields[i][table];
            });

            let fields = row[0][table].filter((item) => {
                return !item.startsWith('ID_');
            });

            setButtons(fields);
        };

        doranAjax(url, data, success);
    };

    const desabilitaAnoMes = (Id) => {
        const anoMes = ['ANO', 'MES']

        if (Id == anoMes[0])
            $('#btn_' + anoMes[1]).prop('disabled', true);

        else if (Id == anoMes[1])
            $('#btn_' + anoMes[0]).prop('disabled', true);
    };

    const setTable = (message) => {
        const names = [
            ['caged', 'RB_CAGED'], 
            ['cgil', 'RB_CGIL'], 
            ['ctps', 'RB_CTPS'],
            ['rais', 'RB_RAIS'],
            ['sismigra_entrada', 'RB_SISMIGRA_ENTRADA'],
            ['sismigra_registro', 'RB_SISMIGRA_REGISTRO'],
            ['sti', 'RB_STI']];

        names.map( (item) => {
            if (message.indexOf(item[0]) > -1) {
                if ($('#' + item[1]).is(':checked')) {
                    habilitaTabela(item[1]);
                }
                else {
                    $('#' + item[1]).click();
                }
            }
        });
    };

    const testAlias = () => {
        QUnit.test("hasAlias", ( assert ) => {
            const _title = 'TIPO_VISTO';
            const result = filterTitle('CGIL', 'lbl_TipoVisto', _title);

            assert.ok( result == _title, "Possui dePara" );
            console.log('Alias testado!');
        });
    };

    const abre = (url) => {
        document.location = url;
    };

    $(document).ready(() => {
        const divs = ['divTabelas', 'divChart', 'divFiltros', 'divMain'];
        const _h = h - 124;

        divs.map((item) => {
            $('#' + item).css('height', _h + 'px');
            $('#' + item).css('overflow', 'auto');
        });

        $('#divChart1').css('height', parseInt(_h * .35) + 'px');
        $('#divGrid').css('height', parseInt(_h * .22) + 'px');

        $('#divMain').css('width', (document.body.offsetWidth) + 'px').change();
        $('#divTop').css('width', (document.body.offsetWidth) + 'px').change();

        setTimeout(() => {
            atualizaGrid([], []);
            $('#RB_CTPS').click();
        }, 500);

        $('#TXT_EMAIL').keyup((e) => {
            event.preventDefault();
            if (event.which == 13) {
                $('#TXT_SENHA').focus();
            }
        });

        $('#TXT_SENHA').keyup((e) => {
            if (event.which == 13) {
                validaLogin();                
            }
        });
    });
</script>